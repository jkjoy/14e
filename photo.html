<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Spw is a dev</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="./img/icon.png">
  <link rel="stylesheet" href="./css/style.min.css">
  <meta name="description" content=""/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdn.imsun.org/Yozai-Medium/result.css" /> 
  <style>
      body {
        font-family: "Yozai Medium", sans-serif;
      }
  </style>
</head>
<body class="loaded"> 
<div id="menu-main-mobile" class="menu-main-mobile">
    <ul class="menu">
                <li >
                    <a href="./">首页</a>
                </li>   
 
                <li >
                    <a href="./photo.html">相册</a>
                </li>                  
                <li >
                    <a href="./article.html">文章</a>
                </li>
                <li >
                    <a href="./links.html">链接</a>
                </li>
                <li >
                    <a href="./about.html">关于</a>
                </li>                
    </ul>
</div>
<div class="header-background">
  <div class='header'>
  <a href="/" class="header-logo">
      <img src="https://q1.qlogo.cn/g?b=qq&nk=80116747&s=100" alt="qq"></img>
  </a>
  <a href="/" class="header-title">14E</a>
  <div class="menu-main"> 
    <div class="header-menu">
      <a href="./">首页</a>
    </div>
 
    <div class="header-menu">
      <a href="./photo.html">照片</a>
    </div>
    <div class="header-menu">
      <a href="./article.html">文章</a>
    </div>
    <div class="header-menu">
      <a href="./links.html">链接</a>
    </div>    
    <div class="header-menu">
      <a href="./about.html">关于</a>
    </div>
        <a href="https://jiong.us/@sun"  target="_blank"><i class="fa-brands fa-mastodon"></i></a>
        
        <a href="https://github.com/jkjoy"  target="_blank"><i class="fa-brands fa-github"></i></a>
      
   </div>
   <div id="toggle-menu-main-mobile" class="hamburger-trigger">
    <button class="hamburger">Menu</button>
   </div>
  </div>
</div>
  <link href="https://cdn.staticfile.org/lightbox2/2.11.3/css/lightbox.min.css" rel="stylesheet">
<script src="https://cdn.staticfile.org/lightbox2/2.11.3/js/lightbox-plus-jquery.min.js" charset="utf-8"></script>
<div id="wrapper" class="wrapper">
  <div class="memos-header">
    <div class="intro"></div>
    <h2># 相册</h2>
    <div class="inner"> 
      <div class="gallery"></div>
    </div> 
  </div> 
</div> 

<style>
  .inner .gallery {
    width: 100%;
    display: flex;
    flex-flow: wrap;
    gap: 10px 20px;
    padding-bottom: 30px;
  }
  
  .inner .gallery .picture-container {
    min-width: 200px;
    flex: 0 0 calc(33.333% - 13.333px);
    aspect-ratio: 1 / 1; /* 使容器保持正方形 */
  }
  
  @media screen and (max-width: 736px) {
    .inner .gallery .picture-container {
      flex: 0 0 calc(50% - 20px);
    }
  }
  
  @media screen and (max-width: 480px) {
    .inner .gallery .picture-container {
      flex: 0 0 100%;
    }
  }
  
  .inner .gallery .picture-container a {
    border: none;
    display: block;
    width: 100%;
    height: 100%;
  }
  
  .inner .gallery .picture-container a .img-thumbnail {
    border-radius: 4px;
    width: 100%;
    height: 100%;
    object-fit: cover; /* 确保图片填充整个容器 */
    object-position: center; /* 居中裁剪 */
  }
  
 
@keyframes spin {
    to { transform: rotate(360deg); }
}

#load-more {
  display: block;
  margin: 30px auto;
  padding: 10px 20px;
  border: 1px solid #ddd;
  border-radius: 20px;
  width: auto !important;
  background-color: #f8f8f8;
  color: #333;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
}
#load-more:hover {
  background-color: #eee;
  border-color: #ccc;
}
#load-more.loading {
  opacity: 0.7;
  cursor: not-allowed;
}
</style>
<script>
let currentPage = 1;
const imagesPerPage = 6;
let allImages = [];

function loadImages(page) {
    const url = 'https://memos.loliko.cn'; // 修改api
    const startIndex = (page - 1) * imagesPerPage;
    const endIndex = startIndex + imagesPerPage;

    fetch(url + '/api/memo?creatorId=1&tag=照片')
        .then(res => res.json())
        .then(data => {
            if (!Array.isArray(data.data)) {
                throw new Error('Expected data.data to be an array');
            }
            let imgs = [];
            data.data.forEach(item => {
                let ls = item.content.match(/\!\[.*?\]\(.*?\)/g);
                if (ls) imgs = imgs.concat(ls);
                if (item.resourceList && item.resourceList.length) {
                    item.resourceList.forEach(t => {
                        if (t.externalLink) imgs.push(`![](${t.externalLink})`);
                        else imgs.push(`![](${url}/o/r/${t.id}/${t.publicId}/${t.filename})`);
                    });
                }
            });

            allImages = imgs;
            displayImages(startIndex, endIndex);
        })
        .catch(error => console.error('Error fetching images:', error));
}

function displayImages(startIndex, endIndex) {
    let html = '';
    const imagesToDisplay = allImages.slice(startIndex, endIndex);

    imagesToDisplay.forEach(item => {
        let img = item.replace(/!\[.*?\]\((.*?)\)/g, '$1'),
            time, title, tat = item.replace(/!\[(.*?)\]\(.*?\)/g, '$1');
        if (tat.indexOf(' ') != -1) {
            [time, title] = tat.split(' ');
        } else {
            title = tat;
        }

        html += `<div class="picture-container">
            <a target="_blank" rel="noopener"
                href="${img}"  data-lightbox="${time}" data-title="${title}">
                <picture>
                    <img src="${img}" class="img-thumbnail" loading="lazy" alt="${title}">
                </picture>
            </a>
        </div>`;
    });

    document.querySelector('.gallery').innerHTML += html;
    if (endIndex < allImages.length) {
        if (!document.getElementById('load-more')) {
            const loadMoreButton = document.createElement('button');
            loadMoreButton.id = 'load-more';
            loadMoreButton.className = 'post-button';
            loadMoreButton.innerHTML = '<span class="btn">加载更多</span>';
            loadMoreButton.onclick = loadNextPage;
            document.querySelector('.gallery').after(loadMoreButton);
        }
    } else {
        const loadMoreButton = document.getElementById('load-more');
        if (loadMoreButton) {
            loadMoreButton.remove();
        }
    }
}

function loadNextPage() {
    const loadMoreButton = document.getElementById('load-more');
    loadMoreButton.classList.add('loading');

    currentPage++;
    const startIndex = (currentPage - 1) * imagesPerPage;
    const endIndex = startIndex + imagesPerPage;

    // 模拟加载延迟
    setTimeout(() => {
        displayImages(startIndex, endIndex);
        loadMoreButton.classList.remove('loading');
    }, 1000); // 1秒延迟，你可以根据实际加载时间调整
}

// 初始加载
document.addEventListener('DOMContentLoaded', () => {
    loadImages(currentPage);
});
</script>
<script defer src="./js/waterfall.min.js"></script>
<script defer src="./js/imgStatus.min.js"></script>
 
<div class="footer-background">
    <div class="footer">
       <div class="footer-info">&copy; 2025 Memos </div>
       <div class="github">
         <a href="https://www.loliko.cn/blog/sitemap.xml" target="_blank" ><img class="header-rss" src="./img/rss.svg" alt="RSS" /></a>
         <a href="mailto:jkjoy@126.com"><img class="header-rss" src="./img/email.svg" alt="E-mail" /></a>
       </div> 
    </div>
 <div class="gotop_hide">
   <div class="gotop" onclick="smoothScrollTop()" id="gotop"><img src="./img/up.svg"  ></div>
 </div>
 </div>
</body>
</html>
